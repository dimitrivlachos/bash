alias ls='ls --color=auto'
module load cuda
module load cmake
export CONDA_PKGS_DIRS="/dls/science/users/rto52325/.conda/pkgs"
alias cdu='cd /dls/science/users/rto52325/'

# Parse git branch
function parse_git_branch() {
    local branch_name="$(git symbolic-ref --short HEAD 2>/dev/null)"
    if [ -n "$branch_name" ]; then
        echo " ($branch_name)"
    fi
}

# Parse virtual environment
function parse_virtualenv() {
    local env_name="$(mamba env list | awk '/^ *\*/ {print $2}' | awk -F'/' '{n=split($0,a,"/"); print a[n-1]"/"a[n]}')"
    local VEN_COLOR="\033[0;32m"
    local RESET_COLOR="\033[0m"
    if [ -n "$env_name" ]; then
        echo -e "(${VEN_COLOR}$env_name${RESET_COLOR}) "
    fi
}

# Map hostname to a more readable name
declare -A HOSTNAME_MAP
HOSTNAME_MAP["cs04r-sc-serv-132.diamond.ac.uk"]="i03-gpu"
HOSTNAME_MAP["cs04r-sc-serv-133.diamond.ac.uk"]="i24-gpu"
# Add more mappings as needed

# Map hostname to a more readable name
function map_hostname() {
    local given_hostname="$1"
    local mapped_name="${HOSTNAME_MAP[$given_hostname]}"
    if [ -n "$mapped_name" ]; then
        echo "$mapped_name"
    else
        echo "\h"
    fi
}

# Set PS1
function set_prompt() {
    if [ "$1" == "short" ]; then
        # Having a function call in PS1 causes the prompt to be slow as it is evaluated every time
        #PS1="\$(parse_virtualenv)${USER_COLOR}\u${RESET_COLOR}@${HOST_COLOR}\h${RESET_COLOR}:${DIR_COLOR}\W${RESET_COLOR}]\$ "

        # Instead, we can call the function once and store the result in a variable
        # This prevents the prompt from automatically updating when the virtual environment changes
        # But speeds up the prompt
        local venv="$(parse_virtualenv)"
        local HOSTNAME="$(map_hostname $(hostname))"
        PS1="${venv}[${USER_COLOR}\u${RESET_COLOR}@${HOST_COLOR}${HOSTNAME}${RESET_COLOR}:${DIR_COLOR}\W${RESET_COLOR}]\$ "
    elif [ "$1" == "long" ]; then
        PS1="\$(parse_virtualenv)[${USER_COLOR}\u${RESET_COLOR}@${HOST_COLOR}\$(map_hostname $(hostname))${RESET_COLOR}:${DIR_COLOR}\w${RESET_COLOR}\$(parse_git_branch)]\$ "
    else
        echo "Usage: prompt [short|long]"
    fi
}

# Define colors
VEN_COLOR="\[\033[0;32m\]"   # Green for virtual environment
DIR_COLOR="\[\033[1;34m\]"   # Blue for directory
USER_COLOR="\[\033[1;33m\]"  # Yellow for username
HOST_COLOR="\[\033[1;33m\]"  # Yellow for hostname
RESET_COLOR="\[\033[0m\]"    # Reset color to default

alias prompt='set_prompt'

# Set prompt to shore mode by default
prompt short